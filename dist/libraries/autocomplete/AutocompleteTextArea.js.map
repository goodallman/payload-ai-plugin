{"version":3,"sources":["../../../src/libraries/autocomplete/AutocompleteTextArea.tsx"],"sourcesContent":["/**\r\n * Credit: Yury Dymov\r\n * Github: https://github.com/yury-dymov/react-autocomplete-input\r\n *\r\n * Modified to only be use for PromptEditorField\r\n */\r\n\r\nimport * as inputSelection from 'get-input-selection'\r\nimport isEqual from 'lodash.isequal'\r\nimport React, { useCallback, useEffect, useRef, useState } from 'react'\r\nimport scrollIntoView from 'scroll-into-view-if-needed'\r\nimport getCaretCoordinates from 'textarea-caret'\r\n\r\nimport styles from './AutocompleteTextArea.module.scss'\r\n\r\nconst KEY_UP = 38\r\nconst KEY_DOWN = 40\r\nconst KEY_RETURN = 13\r\nconst KEY_ENTER = 14\r\nconst KEY_ESCAPE = 27\r\nconst KEY_TAB = 9\r\n\r\nconst OPTION_LIST_MIN_WIDTH = 100\r\n\r\nexport const AutocompleteTextField = (props) => {\r\n  const {\r\n    changeOnSelect = (trigger, slug) => trigger + slug,\r\n    defaultValue = '',\r\n    disabled = false,\r\n    matchAny = false,\r\n    maxOptions = 10,\r\n    minChars = 0,\r\n    offsetX = 0,\r\n    offsetY = 0,\r\n    onBlur = (e: any) => {},\r\n    onChange = (e: any) => {},\r\n    onKeyDown = (e: any) => {},\r\n    onRequestOptions = (e: any) => {},\r\n    onSelect = (e: any) => {},\r\n    options = [],\r\n    passThroughEnter = false,\r\n    passThroughTab = true,\r\n    regex = '^[A-Za-z0-9\\\\-_]+$',\r\n    requestOnlyIfNoOptions = true,\r\n    spaceRemovers = [',', '.', '!', '?'],\r\n    spacer = ' ',\r\n    trigger = '@',\r\n    triggerCaseInsensitive = false,\r\n    triggerMatchWholeWord = false,\r\n    value: propValue = null,\r\n    ...rest\r\n  } = props\r\n\r\n  const [helperVisible, setHelperVisible] = useState(false)\r\n  const [left, setLeft] = useState(0)\r\n  const [top, setTop] = useState(0)\r\n  const [triggerChar, setTriggerChar] = useState(null)\r\n  const [matchLength, setMatchLength] = useState(0)\r\n  const [matchStart, setMatchStart] = useState(0)\r\n  const [selection, setSelection] = useState(0)\r\n  const [value, setValue] = useState(null)\r\n  const [caret, setCaret] = useState(0)\r\n  const [currentOptions, setCurrentOptions] = useState([])\r\n\r\n  const recentValue = useRef(defaultValue)\r\n  const enableSpaceRemovers = useRef(false)\r\n  const inputRef = useRef(null)\r\n  const currentRef = useRef(null)\r\n  const parentRef = useRef(null)\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('resize', handleResize)\r\n    window.addEventListener('scroll', handleResize)\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize)\r\n      window.removeEventListener('scroll', handleResize)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!isEqual(options, currentOptions)) {\r\n      updateHelper(recentValue.current, caret, options)\r\n    }\r\n  }, [options, caret])\r\n\r\n  useEffect(() => {\r\n    if (helperVisible && currentRef.current) {\r\n      scrollIntoView(currentRef.current, { boundary: parentRef.current, scrollMode: 'if-needed' })\r\n    }\r\n  }, [helperVisible, selection])\r\n\r\n  const handleResize = useCallback(() => {\r\n    setHelperVisible(false)\r\n  }, [])\r\n\r\n  const isTrigger = useCallback(\r\n    (triggerStr, str, i) => {\r\n      if (!triggerStr || !triggerStr.length) {\r\n        return true\r\n      }\r\n\r\n      if (triggerMatchWholeWord && i > 0 && str.charAt(i - 1).match(/\\w/)) {\r\n        return false\r\n      }\r\n\r\n      if (\r\n        str.substr(i, triggerStr.length) === triggerStr ||\r\n        (triggerCaseInsensitive &&\r\n          str.substr(i, triggerStr.length).toLowerCase() === triggerStr.toLowerCase())\r\n      ) {\r\n        return true\r\n      }\r\n\r\n      return false\r\n    },\r\n    [triggerMatchWholeWord, triggerCaseInsensitive],\r\n  )\r\n\r\n  const arrayTriggerMatch = useCallback((triggers, re) => {\r\n    return triggers.map((trigger) => ({\r\n      triggerLength: trigger.length,\r\n      triggerMatch: trigger.match(re),\r\n      triggerStr: trigger,\r\n    }))\r\n  }, [])\r\n\r\n  const getMatch = useCallback(\r\n    (str, caret, providedOptions) => {\r\n      const re = new RegExp(regex)\r\n      const triggers = Array.isArray(trigger) ? trigger : [trigger]\r\n      triggers.sort()\r\n\r\n      const providedOptionsObject = Array.isArray(providedOptions)\r\n        ? triggers.reduce((acc, triggerStr) => ({ ...acc, [triggerStr]: providedOptions }), {})\r\n        : providedOptions\r\n\r\n      const triggersMatch = arrayTriggerMatch(triggers, re)\r\n      let slugData = null\r\n\r\n      for (let triggersIndex = 0; triggersIndex < triggersMatch.length; triggersIndex++) {\r\n        const { triggerLength, triggerMatch, triggerStr } = triggersMatch[triggersIndex]\r\n\r\n        for (let i = caret - 1; i >= 0; --i) {\r\n          const substr = str.substring(i, caret)\r\n          const match = substr.match(re)\r\n          let matchStart = -1\r\n\r\n          if (triggerLength > 0) {\r\n            const triggerIdx = triggerMatch ? i : i - triggerLength + 1\r\n\r\n            if (triggerIdx < 0) {\r\n              break\r\n            }\r\n\r\n            if (isTrigger(triggerStr, str, triggerIdx)) {\r\n              matchStart = triggerIdx + triggerLength\r\n            }\r\n\r\n            if (!match && matchStart < 0) {\r\n              break\r\n            }\r\n          } else {\r\n            if (match && i > 0) {\r\n              continue\r\n            }\r\n            matchStart = i === 0 && match ? 0 : i + 1\r\n\r\n            if (caret - matchStart === 0) {\r\n              break\r\n            }\r\n          }\r\n\r\n          if (matchStart >= 0) {\r\n            const triggerOptions = providedOptionsObject[triggerStr]\r\n            if (triggerOptions == null) {\r\n              continue\r\n            }\r\n\r\n            const matchedSlug = str.substring(matchStart, caret)\r\n\r\n            const filteredOptions = triggerOptions.filter((slug) => {\r\n              const idx = slug.toLowerCase().indexOf(matchedSlug.toLowerCase())\r\n              return idx !== -1 && (matchAny || idx === 0)\r\n            })\r\n\r\n            const currTrigger = triggerStr\r\n            const matchLength = matchedSlug.length\r\n\r\n            slugData = {\r\n              matchLength,\r\n              matchStart,\r\n              options: filteredOptions,\r\n              trigger: currTrigger,\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return slugData\r\n    },\r\n    [regex, trigger, arrayTriggerMatch, isTrigger, matchAny],\r\n  )\r\n\r\n  const updateCaretPosition = useCallback((newCaret) => {\r\n    requestAnimationFrame(() => {\r\n      setCaret(newCaret)\r\n      if (inputRef.current && typeof inputRef.current.setSelectionRange === 'function') {\r\n        inputRef.current.setSelectionRange(newCaret, newCaret)\r\n      }\r\n    })\r\n  }, [])\r\n\r\n  const updateHelper = useCallback(\r\n    (str, caretPos, helperOptions) => {\r\n      const slug = getMatch(str, caretPos, helperOptions)\r\n\r\n      if (slug) {\r\n        const caretCoordinates = getCaretCoordinates(inputRef.current, caretPos)\r\n        const rect = inputRef.current.getBoundingClientRect()\r\n\r\n        const newTop = caretCoordinates.top + rect.top - inputRef.current.scrollTop\r\n        const newLeft = Math.min(\r\n          caretCoordinates.left + rect.left - inputRef.current.scrollLeft,\r\n          window.innerWidth - OPTION_LIST_MIN_WIDTH,\r\n        )\r\n\r\n        if (\r\n          slug.matchLength >= minChars &&\r\n          (slug.options.length > 1 ||\r\n            (slug.options.length === 1 &&\r\n              (slug.options[0].length !== slug.matchLength || slug.options[0].length === 1)))\r\n        ) {\r\n          setHelperVisible(true)\r\n          setTop(newTop)\r\n          setLeft(newLeft)\r\n          setTriggerChar(slug.trigger)\r\n          setMatchLength(slug.matchLength)\r\n          setMatchStart(slug.matchStart)\r\n          setCurrentOptions(slug.options)\r\n        } else {\r\n          if (!requestOnlyIfNoOptions || !slug.options.length) {\r\n            onRequestOptions(str.substr(slug.matchStart, slug.matchLength))\r\n          }\r\n          resetHelper()\r\n        }\r\n        updateCaretPosition(caretPos)\r\n      } else {\r\n        resetHelper()\r\n      }\r\n    },\r\n    [getMatch, minChars, requestOnlyIfNoOptions, onRequestOptions, updateCaretPosition],\r\n  )\r\n\r\n  const resetHelper = useCallback(() => {\r\n    setHelperVisible(false)\r\n    setSelection(0)\r\n  }, [])\r\n\r\n  const handleChange = useCallback(\r\n    (e) => {\r\n      const str = e.target.value\r\n      const caretPos = inputSelection.default(e.target).end\r\n\r\n      if (!str.length) {\r\n        setHelperVisible(false)\r\n      }\r\n\r\n      recentValue.current = str\r\n\r\n      if (!str.length || !caretPos) {\r\n        return onChange(e.target.value)\r\n      }\r\n\r\n      // Space removers logic\r\n      if (enableSpaceRemovers.current && spaceRemovers.length && str.length > 2 && spacer.length) {\r\n        for (let i = 0; i < Math.max(recentValue.current.length, str.length); ++i) {\r\n          if (recentValue.current[i] !== str[i]) {\r\n            if (\r\n              i >= 2 &&\r\n              str[i - 1] === spacer &&\r\n              spaceRemovers.indexOf(str[i - 2]) === -1 &&\r\n              spaceRemovers.indexOf(str[i]) !== -1 &&\r\n              getMatch(str.substring(0, i - 2), caretPos - 3, options)\r\n            ) {\r\n              const newValue = `${str.slice(0, i - 1)}${str.slice(i, i + 1)}${str.slice(i - 1, i)}${str.slice(i + 1)}`\r\n\r\n              updateCaretPosition(i + 1)\r\n              inputRef.current.value = newValue\r\n\r\n              if (!propValue) {\r\n                setValue(newValue)\r\n              }\r\n\r\n              return onChange(newValue)\r\n            }\r\n\r\n            break\r\n          }\r\n        }\r\n\r\n        enableSpaceRemovers.current = false\r\n      }\r\n\r\n      updateHelper(str, caretPos, options)\r\n\r\n      if (!propValue) {\r\n        setValue(e.target.value)\r\n      }\r\n\r\n      return onChange(e.target.value)\r\n    },\r\n    [\r\n      onChange,\r\n      propValue,\r\n      spaceRemovers,\r\n      spacer,\r\n      options,\r\n      updateCaretPosition,\r\n      updateHelper,\r\n      getMatch,\r\n    ],\r\n  )\r\n\r\n  const handleBlur = useCallback(\r\n    (e) => {\r\n      resetHelper()\r\n      onBlur(e)\r\n    },\r\n    [onBlur, resetHelper],\r\n  )\r\n\r\n  const handleSelection = useCallback(\r\n    (idx) => {\r\n      const slug = currentOptions[idx]\r\n      const value = recentValue.current\r\n      const part1 =\r\n        triggerChar.length === 0 ? '' : value.substring(0, matchStart - triggerChar.length)\r\n      const part2 = value.substring(matchStart + matchLength)\r\n\r\n      const event = { target: inputRef.current }\r\n      const changedStr = changeOnSelect(triggerChar, slug)\r\n\r\n      event.target.value = `${part1}${changedStr}${spacer}${part2}`\r\n      handleChange(event)\r\n      onSelect(event.target.value)\r\n\r\n      resetHelper()\r\n\r\n      const advanceCaretDistance = part1.length + changedStr.length + (spacer ? spacer.length : 1)\r\n      updateCaretPosition(advanceCaretDistance)\r\n\r\n      enableSpaceRemovers.current = true\r\n    },\r\n    [\r\n      currentOptions,\r\n      triggerChar,\r\n      matchStart,\r\n      matchLength,\r\n      changeOnSelect,\r\n      spacer,\r\n      handleChange,\r\n      onSelect,\r\n      resetHelper,\r\n      updateCaretPosition,\r\n    ],\r\n  )\r\n\r\n  const handleKeyDown = useCallback(\r\n    (event) => {\r\n      const optionsCount =\r\n        maxOptions > 0 ? Math.min(currentOptions.length, maxOptions) : currentOptions.length\r\n\r\n      if (helperVisible) {\r\n        switch (event.keyCode) {\r\n          case KEY_ESCAPE:\r\n            event.preventDefault()\r\n            resetHelper()\r\n            break\r\n          case KEY_UP:\r\n            event.preventDefault()\r\n            if (optionsCount > 0) {\r\n              setSelection(\r\n                (prevSelection) => Math.max(0, optionsCount + prevSelection - 1) % optionsCount,\r\n              )\r\n            }\r\n            break\r\n          case KEY_DOWN:\r\n            event.preventDefault()\r\n            if (optionsCount > 0) {\r\n              setSelection((prevSelection) => (prevSelection + 1) % optionsCount)\r\n            }\r\n            break\r\n          case KEY_ENTER:\r\n          case KEY_RETURN:\r\n            if (!passThroughEnter) {\r\n              event.preventDefault()\r\n            }\r\n            handleSelection(selection)\r\n            break\r\n          case KEY_TAB:\r\n            if (!passThroughTab) {\r\n              event.preventDefault()\r\n            }\r\n            handleSelection(selection)\r\n            break\r\n          default:\r\n            onKeyDown(event)\r\n            break\r\n        }\r\n      } else {\r\n        onKeyDown(event)\r\n      }\r\n    },\r\n    [\r\n      helperVisible,\r\n      currentOptions,\r\n      maxOptions,\r\n      passThroughEnter,\r\n      passThroughTab,\r\n      selection,\r\n      onKeyDown,\r\n      resetHelper,\r\n      handleSelection,\r\n    ],\r\n  )\r\n\r\n  const renderAutocompleteList = useCallback(() => {\r\n    if (!helperVisible || currentOptions.length === 0) {\r\n      return null\r\n    }\r\n\r\n    if (selection >= currentOptions.length) {\r\n      setSelection(0)\r\n      return null\r\n    }\r\n\r\n    const optionNumber = maxOptions === 0 ? currentOptions.length : maxOptions\r\n\r\n    const helperOptions = currentOptions.slice(0, optionNumber).map((val, idx) => {\r\n      let [helper, value] = val.split(' ')\r\n      if (!value) {\r\n        helper = undefined\r\n        value = val\r\n      }\r\n\r\n      const renderHighlightedText = (text) => {\r\n        const highlightStart = text\r\n          .toLowerCase()\r\n          .indexOf(recentValue.current.substr(matchStart, matchLength).toLowerCase())\r\n\r\n        const highlightedText = text.substr(highlightStart, matchLength)\r\n\r\n        if (!val.startsWith(text)) {\r\n          return text\r\n        }\r\n\r\n        return (\r\n          <React.Fragment>\r\n            {text.slice(0, highlightStart)}\r\n            <strong>{highlightedText}</strong>\r\n            {text.slice(highlightStart + matchLength)}\r\n          </React.Fragment>\r\n        )\r\n      }\r\n\r\n      return (\r\n        <li\r\n          className={idx === selection ? styles.active : null}\r\n          key={val}\r\n          onClick={() => {\r\n            handleSelection(idx)\r\n          }}\r\n          onMouseDown={(e) => {\r\n            e.preventDefault()\r\n          }}\r\n          onMouseEnter={() => {\r\n            setSelection(idx)\r\n          }}\r\n          ref={idx === selection ? currentRef : null}\r\n          role=\"presentation\"\r\n        >\r\n          {helper && <code className={styles.helper}>{renderHighlightedText(helper)}</code>}\r\n          {renderHighlightedText(value)}\r\n        </li>\r\n      )\r\n    })\r\n\r\n    const maxWidth = window.innerWidth - left - offsetX - 5\r\n    const maxHeight = window.innerHeight - top - offsetY - 5\r\n\r\n    return (\r\n      <ul\r\n        className={styles.autocompleteInput + ' ' + 'popup__content'}\r\n        ref={parentRef}\r\n        style={{\r\n          left: left + offsetX,\r\n          maxHeight,\r\n          maxWidth,\r\n          opacity: 'initial',\r\n          pointerEvents: 'initial',\r\n          position: 'fixed',\r\n          top: top + offsetY,\r\n          visibility: 'initial',\r\n        }}\r\n      >\r\n        {helperOptions}\r\n      </ul>\r\n    )\r\n  }, [\r\n    helperVisible,\r\n    currentOptions,\r\n    selection,\r\n    maxOptions,\r\n    left,\r\n    top,\r\n    offsetX,\r\n    offsetY,\r\n    matchStart,\r\n    matchLength,\r\n    handleSelection,\r\n  ])\r\n\r\n  return (\r\n    <div className=\"popup\">\r\n      <textarea\r\n        className=\"textarea-outer\"\r\n        disabled={disabled}\r\n        onBlur={handleBlur}\r\n        onChange={handleChange}\r\n        onKeyDown={handleKeyDown}\r\n        ref={inputRef}\r\n        rows={6}\r\n        style={{ overflow: 'auto' }}\r\n        value={propValue !== null ? propValue : value || defaultValue}\r\n        {...rest}\r\n      />\r\n      {renderAutocompleteList()}\r\n    </div>\r\n  )\r\n}\r\n"],"names":["inputSelection","isEqual","React","useCallback","useEffect","useRef","useState","scrollIntoView","getCaretCoordinates","styles","KEY_UP","KEY_DOWN","KEY_RETURN","KEY_ENTER","KEY_ESCAPE","KEY_TAB","OPTION_LIST_MIN_WIDTH","AutocompleteTextField","props","changeOnSelect","trigger","slug","defaultValue","disabled","matchAny","maxOptions","minChars","offsetX","offsetY","onBlur","e","onChange","onKeyDown","onRequestOptions","onSelect","options","passThroughEnter","passThroughTab","regex","requestOnlyIfNoOptions","spaceRemovers","spacer","triggerCaseInsensitive","triggerMatchWholeWord","value","propValue","rest","helperVisible","setHelperVisible","left","setLeft","top","setTop","triggerChar","setTriggerChar","matchLength","setMatchLength","matchStart","setMatchStart","selection","setSelection","setValue","caret","setCaret","currentOptions","setCurrentOptions","recentValue","enableSpaceRemovers","inputRef","currentRef","parentRef","window","addEventListener","handleResize","removeEventListener","updateHelper","current","boundary","scrollMode","isTrigger","triggerStr","str","i","length","charAt","match","substr","toLowerCase","arrayTriggerMatch","triggers","re","map","triggerLength","triggerMatch","getMatch","providedOptions","RegExp","Array","isArray","sort","providedOptionsObject","reduce","acc","triggersMatch","slugData","triggersIndex","substring","triggerIdx","triggerOptions","matchedSlug","filteredOptions","filter","idx","indexOf","currTrigger","updateCaretPosition","newCaret","requestAnimationFrame","setSelectionRange","caretPos","helperOptions","caretCoordinates","rect","getBoundingClientRect","newTop","scrollTop","newLeft","Math","min","scrollLeft","innerWidth","resetHelper","handleChange","target","default","end","max","newValue","slice","handleBlur","handleSelection","part1","part2","event","changedStr","advanceCaretDistance","handleKeyDown","optionsCount","keyCode","preventDefault","prevSelection","renderAutocompleteList","optionNumber","val","helper","split","undefined","renderHighlightedText","text","highlightStart","highlightedText","startsWith","Fragment","strong","li","className","active","onClick","onMouseDown","onMouseEnter","ref","role","code","maxWidth","maxHeight","innerHeight","ul","autocompleteInput","style","opacity","pointerEvents","position","visibility","div","textarea","rows","overflow"],"mappings":"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"}
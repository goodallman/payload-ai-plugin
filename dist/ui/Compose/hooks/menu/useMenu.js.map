{"version":3,"sources":["../../../../../src/ui/Compose/hooks/menu/useMenu.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useField } from '@payloadcms/ui'\r\nimport React, { useEffect, useMemo, useState } from 'react'\r\n\r\nimport { ActionMenuItems, UseMenuEvents, UseMenuOptions } from '../../../../types.js'\r\nimport { translateToCzech } from '../../../../utilities/translateToCzech.js'\r\n\r\nimport { useFieldProps } from '../../../../providers/FieldProvider/useFieldProps.js'\r\nimport { Compose, Proofread, Rephrase } from './items.js'\r\nimport { menuItemsMap } from './itemsMap.js'\r\nimport styles from './menu.module.scss'\r\n\r\nconst getActiveComponent = (ac) => {\r\n  switch (ac) {\r\n    case 'Proofread':\r\n      return Proofread\r\n    case 'Rephrase':\r\n      return Rephrase\r\n    case 'Compose':\r\n      return Compose\r\n    default:\r\n      return Rephrase\r\n  }\r\n}\r\n\r\nexport const useMenu = (menuEvents: UseMenuEvents, options: UseMenuOptions) => {\r\n  const { type: fieldType, path: pathFromContext } = useFieldProps()\r\n  const field = useField({ path: pathFromContext })\r\n  const [activeComponent, setActiveComponent] = useState<ActionMenuItems>('Rephrase')\r\n\r\n  const { initialValue, value } = field\r\n\r\n  useEffect(() => {\r\n    if (!value) {\r\n      setActiveComponent('Compose')\r\n      return\r\n    }\r\n\r\n    if (menuItemsMap.some((i) => i.excludedFor?.includes(fieldType))) {\r\n      setActiveComponent('Compose')\r\n      return\r\n    }\r\n\r\n    if (typeof value === 'string' && value !== initialValue) {\r\n      setActiveComponent('Proofread')\r\n    } else {\r\n      setActiveComponent('Rephrase')\r\n    }\r\n  }, [initialValue, value, fieldType])\r\n\r\n  const MemoizedActiveComponent = useMemo(() => {\r\n    return ({ isLoading, stop }) => {\r\n      const ActiveComponent = getActiveComponent(activeComponent)\r\n      const activeItem = menuItemsMap.find((i) => i.name === activeComponent)\r\n      return (\r\n        <ActiveComponent\r\n          hideIcon\r\n          onClick={(data) => {\r\n            if (!isLoading) {\r\n              const trigger = menuEvents[`on${activeComponent}`]\r\n              if (typeof trigger === 'function') {\r\n                trigger(data)\r\n              } else {\r\n                console.error('No trigger found for', activeComponent)\r\n              }\r\n            } else {\r\n              stop()\r\n            }\r\n          }}\r\n          title={translateToCzech(isLoading ? 'Click to stop' : activeItem.name)}\r\n        >\r\n          {isLoading && translateToCzech(activeItem.loadingText)}\r\n        </ActiveComponent>\r\n      )\r\n    }\r\n  }, [activeComponent])\r\n\r\n  const filteredMenuItems = useMemo(\r\n    () =>\r\n      menuItemsMap.filter((i) => {\r\n        if (i.name === 'Settings' && !options.isConfigAllowed) return false; // Disable settings if a user role is not permitted\r\n        return i.name !== activeComponent && !i.excludedFor?.includes(fieldType);\r\n      }),\r\n    [activeComponent, fieldType, options.isConfigAllowed],\r\n  );\r\n\r\n  const MemoizedMenu = useMemo(() => {\r\n    return ({ isLoading, onClose }) => (\r\n      <div className={styles.menu}>\r\n        {filteredMenuItems.map((i) => {\r\n          const Action = i.component\r\n          return (\r\n            <Action\r\n              disabled={isLoading}\r\n              key={i.name}\r\n              onClick={(data) => {\r\n                if (i.name !== 'Settings') {\r\n                  setActiveComponent(i.name)\r\n                }\r\n\r\n                menuEvents[`on${i.name}`]?.(data)\r\n                onClose()\r\n              }}\r\n            >\r\n              {isLoading && translateToCzech(i.loadingText)}\r\n            </Action>\r\n          )\r\n        })}\r\n      </div>\r\n    )\r\n  }, [filteredMenuItems])\r\n\r\n  return {\r\n    ActiveComponent: MemoizedActiveComponent,\r\n    Menu: MemoizedMenu,\r\n  }\r\n}\r\n"],"names":["useField","React","useEffect","useMemo","useState","translateToCzech","useFieldProps","Compose","Proofread","Rephrase","menuItemsMap","styles","getActiveComponent","ac","useMenu","menuEvents","options","type","fieldType","path","pathFromContext","field","activeComponent","setActiveComponent","initialValue","value","some","i","excludedFor","includes","MemoizedActiveComponent","isLoading","stop","ActiveComponent","activeItem","find","name","hideIcon","onClick","data","trigger","console","error","title","loadingText","filteredMenuItems","filter","isConfigAllowed","MemoizedMenu","onClose","div","className","menu","map","Action","component","disabled","Menu"],"mappings":"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"}